/*
 * Queue_Can.c
 *
 *  Created on: Aug 15, 2025
 */

#ifdef __cplusplus
extern "C"{
#endif

/*==================================================================================================
 *                                          INCLUDE FILES
 * 1) system and project includes
 * 2) needed interfaces from external units
 * 3) internal and external interfaces from this unit
 ==================================================================================================*/
#include "Queue_Can.h"
#include "Vmu_Msg.h"
/*==================================================================================================
 SOURCE FILE VERSION INFORMATION
 ==================================================================================================*/

/*==================================================================================================
 *                                     FILE VERSION CHECKS
 ==================================================================================================*/

/*==================================================================================================
 *                           LOCAL TYPEDEFS (STRUCTURES, UNIONS, ENUMS)
 ==================================================================================================*/

/*==================================================================================================
 *                                          LOCAL MACROS
 ==================================================================================================*/

/*==================================================================================================
 *                                         LOCAL CONSTANTS
 ==================================================================================================*/

/*==================================================================================================
 *                                         LOCAL VARIABLES
 ==================================================================================================*/

/*==================================================================================================
 *                                        GLOBAL CONSTANTS
 ==================================================================================================*/

/*==================================================================================================
 *                                        GLOBAL VARIABLES
 ==================================================================================================*/
CanQueue_t CanRxQueue = {0};
/*==================================================================================================
 *                                    LOCAL FUNCTION PROTOTYPES
 ==================================================================================================*/

/*==================================================================================================
 *                                         LOCAL VARIABLES
 ==================================================================================================*/

/*==================================================================================================
 *                                         LOCAL FUNCTIONS
 ==================================================================================================*/

/**
 * @brief
 * @param 
 * @return
 * @details
 */

/*==================================================================================================
 *                                         GLOBAL FUNCTIONS
 ==================================================================================================*/
void CanQueue_Init(CanQueue_t *q)
{
    q->head = q->tail = 0;
}

Std_ReturnType CanQueue_Push(CanQueue_t *q, CanMsgRxType *frame)
{
    uint16_t next = (q->head + 1) % CAN_QUEUE_SIZE;
    if (next == q->tail) return E_NOT_OK; // full
    q->buffer[q->head] = *frame;
    q->head = next;
    return E_OK;
}

Std_ReturnType CanQueue_Pop(CanQueue_t *q, CanMsgRxType *frame)
{
    if (q->head == q->tail) return E_NOT_OK; // empty
    *frame = q->buffer[q->tail];
    q->tail = (q->tail + 1) % CAN_QUEUE_SIZE;
    return E_OK;
}

Std_ReturnType CanQueue_IsEmpty(CanQueue_t *q)
{
    return (q->head == q->tail);
}

#ifdef __cplusplus
}
#endif
